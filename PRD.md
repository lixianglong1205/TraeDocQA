# 智能文档问答系统产品需求文档（PRD）

## 1. 概述
本系统旨在构建一个基于文档的智能问答应用，支持用户上传文档（PDF/TXT），自动提取“问题-答案”对（FAQ），并通过语义检索与大型语言模型（LLM）驱动的方式，为用户提供精准、流畅的问答交互体验。

## 2. 技术架构与约束

### 2.1 开发环境与框架
- **Python 环境管理**：必须使用 `uv` 进行依赖管理与环境配置。
- **Agent 开发框架**：必须使用 `LangChain` 进行 Agent 的开发与集成。
- **代码规范**：必须遵循《代码整洁之道》原则进行命名与编写，确保代码结构清晰、无冗余。
- **并发模型**：必须使用同步代码逻辑编写，禁止使用多线程、多进程或异步方式。
- **前端框架**：使用 `Streamlit` 进行网页开发。

### 2.2 模型选型
- **对话 LLM**：必须使用 `deepseek-reasoner` 类型模型，版本选择 `DeepSeek-V3.2`（思考模式）。
- **Embedding 模型**：选用 OpenAI 的 embedding API，不采用国产化或本地部署方案。

## 3. 功能模块详述

### 3.1 网页前端（Streamlit）
#### 3.1.1 文档上传页面
- 提供文件上传组件，支持 PDF 与 TXT 格式。
- 格式校验：通过正则表达式校验文件后缀，若非 PDF/TXT，前端弹出警告提示。
- 用户交互：上传后显示文件名称与状态。

#### 3.1.2 聊天交互页面
- 仿照 ChatGPT 交互风格，支持流式输出回答。
- 功能按钮：支持对回答进行“点赞”、“点踩”、“重新生成”操作。
- 对话历史：保留当前会话的问答记录。

### 3.2 文档解析模块
- **PDF 解析**：使用 LangChain 提供的 PDF 解析器，针对纯文本型 PDF 输出文本内容。
- **TXT 解析**：使用 LangChain 的文本解析器，兼容 Windows（如 GBK）与 Mac/Linux（如 UTF-8）编码格式。
- **容错处理**：若文件读取失败，前端显示预警信息，但不中断系统运行，用户可重新上传。

### 3.3 FAQ 提取模块
- **输入**：非结构化文本（来自文档解析）。
- **处理流程**：
  
  - 采用滑动窗口法，窗口大小为 2K tokens，滑动重叠 500 tokens。
  - 每个窗口内容送入 LLM（DeepSeek 基座模型）进行“问题-答案”对抽取。
- **输出格式**：JSON 列表，示例：
  
  ```json
  [
    {"问题": "示例问题1?", "答案": "示例答案1。"},
    {"问题": "示例问题2?", "答案": "示例答案2。"}
  ]
  ```

### 3.4 向量存储模块
- **向量数据库**：使用 LangChain 集成的 Chroma 向量数据库存储 FAQ 的嵌入向量。
- **Embedding 生成**：调用 OpenAI Embedding API 将 FAQ 中的“问题”文本转换为向量。
- **索引构建**：FAQ 存入后即构建向量索引，支持后续语义检索。

### 3.5 问答处理流程
1. **问题识别**  
   - 使用 LLM 判断用户输入是否为提问句（二分类任务，输出“是”/“否”）。
   - 若非问句，系统以闲聊模式与用户交互。

2. **意图识别**  
   - 使用 LLM 判断提问是否为计算类问题（二分类任务）。
   - 若是计算问题，调用计算器 Tool 处理并返回结果。

3. **语义检索与相关性筛选**  
   - 用户提问经 Embedding 接口编码后，在向量库中检索 Top-N 个相似 FAQ 问题。
   - 使用 LLM 判断检索到的 FAQ 是否与用户提问相关：
     - 若均不相关，回复“未找到相关内容”。
     - 若相关，进入答案生成阶段。

4. **答案生成**  
   - 对每个检索到的 FAQ，使用 LLM 进行二分类判断是否与用户提问匹配。
   - 将匹配的 FAQ 答案与问题一起拼接为 Prompt，送入 LLM 生成最终回复。

## 4. 非功能性需求
- **可用性**：前端交互简洁，流式输出延迟低于 10 秒。
- **可维护性**：代码结构清晰，模块解耦，便于后续迭代。
- **安全性**：API 密钥等敏感信息通过环境变量管理，不入库。

## 5. 输出与交付物
- 可运行的 Streamlit 应用。
- 完整的代码仓库，包含清晰目录结构与 README。
- 配置说明文档，包括环境安装、依赖部署与启动步骤。

---
**备注**：本文档为系统实现的基础蓝图，具体实现中需保持模块化开发与充分测试，确保各环节稳定衔接。